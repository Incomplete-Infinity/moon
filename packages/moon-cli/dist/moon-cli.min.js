#!/usr/bin/env node
/**
 * Moon CLI v1.0.0-beta.4
 * Copyright 2016-2019 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(){"use strict";var o,c,s=require("fs"),m=require("path"),n=require("https"),a=require("child_process").exec,t=/<\w+>/g,r=/\[\w+\]|--?\w+/g,e={version:{usage:"moon version",description:"output Moon CLI version"},help:{usage:"moon help <command>",description:"output help message for command",parameters:{"<command>":"name of Moon CLI command"}},create:{usage:"moon create <name> [options]",description:"create application in new directory",parameters:{"<name>":"name of application and directory"},options:{"-t, --template <username>/<repository>":"GitHub repository to use as template"}}};function i(n){var e=Object.keys(n),t=Math.max.apply(null,e.map(function(e){return e.length}));return e.map(function(e){return"\t"+e+" ".repeat(t-e.length+3)+n[e]}).join("\n")}function l(e,n){console.log("\x1b[34m"+e+"\x1b[0m "+n)}function p(e){console.log(function(e){return e.replace(t,"\x1b[33m$&\x1b[0m").replace(r,"\x1b[36m$&\x1b[0m")}(e))}function u(e){console.log("\x1b[31merror\x1b[0m "+e)}function d(e,n,t){var o=e.indexOf(n);if(-1===o)return e;var a=e.slice(0,o),r=d(e.slice(o+n.length),n,t),i=Buffer.from(t);return Buffer.concat([a,i,r],a.length+i.length+r.length)}function f(e){var n=m.join(__dirname,"moon-template.tar.gz"),t=s.createWriteStream(n);e.on("data",function(e){t.write(e)}),e.on("end",function(){t.end(),l("download",o),function(n){var t=m.join(process.cwd(),c);a("mkdir "+t,function(e){if(e)throw e;a("tar -xzf "+n+" -C "+t+" --strip=1",function(e){if(e)throw e;l("install",t),function(n,t){s.unlink(n,function(e){if(e)throw e;l("clean",n),function e(n,t){var o=s.readdirSync(n);for(var a=0;a<o.length;a++){var r=o[a],i=m.join(n,r);s.statSync(i).isDirectory()?e(i,t):(s.writeFileSync(i,d(s.readFileSync(i),"{# MoonName #}",c)),l("create",m.relative(t,i)))}}(t,t),l("success","Generated application \x1b[36m"+c+"\x1b[0m"),console.log("To start, run:\n\tcd "+c+"\n\tnpm install\n\tnpm run dev")})}(n,t)})})}(n)})}for(var v=2===process.argv.length?["help"]:process.argv.slice(2),h=v[0],g=[],w={},k=1;k<v.length;k++){var y=v[k];if("-"===y[0])for(;k<v.length;k++){var b=v[k];"-"===b[0]?w[b]=!0:w[v[k-1]]=b}else g.push(y)}switch(h){case"version":p("Moon CLI v1.0.0-beta.4");break;case"help":var x=g[0];if(x in e){var C=e[x];p("Usage: "+C.usage+"\n\t"+C.description),"parameters"in C&&p("\nParameters:\n"+i(C.parameters)),"options"in C&&p("\nOptions:\n"+i(C.options))}else{var M={};for(var R in e){var j=e[R];M[j.usage]=j.description}p("Usage: moon <command> [options]\n\nCommands:\n"+i(M))}break;case"create":c=g[0],o=w["-t"]||w["--template"]||"kbrsh/moon-template",void 0!==c&&0!==c.length||u("Invalid or unknown name.\n\nAttempted to create an application.\n\nReceived an invalid or unknown name.\n\nExpected a valid name. Run \x1b[35mmoon help create\x1b[0m to see usage information."),!0===o&&u("Invalid or unknown template.\n\nAttempted to create an application.\n\nReceived an invalid or unknown template.\n\nExpected a valid template. Run \x1b[35mmoon help create\x1b[0m to see usage information.");var I={method:"GET",host:"api.github.com",path:"/repos/"+o+"/tarball/master",headers:{"User-Agent":"Moon"}};l("Moon","Generating application"),n.get(I,function(e){300<=e.statusCode&&e.statusCode<400&&void 0!==e.headers.location?n.get(e.headers.location,function(e){f(e)}):f(e)});break;default:u("Unrecognized command.\n\nAttempted to execute a command.\n\nReceived a command that does not exist:\n\t"+h+"\n\nExpected a valid command. Run \x1b[35mmoon help\x1b[0m to see valid commands.")}}();