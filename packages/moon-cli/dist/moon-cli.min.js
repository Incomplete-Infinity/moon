#!/usr/bin/env node
/**
 * Moon CLI v1.0.0-beta.4
 * Copyright 2016-2019 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(){"use strict";var e,n,t=require("fs"),o=require("path"),a=require("https"),r=require("child_process").exec,i=/<\w+>/g,c=/(?:^|\s)(?:\[\w+\]|--?\w+)/g,s={version:{usage:"moon version",description:"output Moon CLI version"},help:{usage:"moon help <command>",description:"output help message for command",parameters:{"<command>":"name of Moon CLI command"}},create:{usage:"moon create <name> [options]",description:"create application in new directory",parameters:{"<name>":"name of application and directory"},options:{"-t, --template <username>/<repository>":"GitHub repository to use as template"}}};function m(e){var n=Object.keys(e),t=Math.max.apply(null,n.map((function(e){return e.length})));return n.map((function(n){return"\t"+n+" ".repeat(t-n.length+3)+e[n]})).join("\n")}function l(e,n){console.log("\x1b[34m"+e+"\x1b[0m "+n)}function p(e){console.log(e.replace(i,"\x1b[33m$&\x1b[0m").replace(c,"\x1b[36m$&\x1b[0m"))}function d(e){console.log("\x1b[31merror\x1b[0m "+e)}function u(e,n,t){var o=e.indexOf(n);if(-1===o)return e;var a=e.slice(0,o),r=u(e.slice(o+n.length),n,t),i=Buffer.from(t);return Buffer.concat([a,i,r],a.length+i.length+r.length)}function f(a){var i=o.join(__dirname,"moon-template.tar.gz"),c=t.createWriteStream(i);a.on("data",(function(e){c.write(e)})),a.on("end",(function(){c.end(),l("download",e),function(e){var a=o.join(process.cwd(),n);r("mkdir "+a,(function(i){if(i)throw i;r("tar -xzf "+e+" -C "+a+" --strip=1",(function(r){if(r)throw r;l("install",a),function(e,a){t.unlink(e,(function(r){if(r)throw r;l("clean",e),function e(a,r){for(var i=t.readdirSync(a),c=0;c<i.length;c++){var s=i[c],m=o.join(a,s);t.statSync(m).isDirectory()?e(m,r):(t.writeFileSync(m,u(t.readFileSync(m),"{# MoonName #}",n)),l("create",o.relative(r,m)))}}(a,a),l("success","Generated application \x1b[36m"+n+"\x1b[0m"),console.log("To start, run:\n\tcd "+n+"\n\tnpm install\n\tnpm run dev")}))}(e,a)}))}))}(i)}))}for(var v=2===process.argv.length?["help"]:process.argv.slice(2),h=v[0],g=[],w={},k=1;k<v.length;k++){var y=v[k];if("-"===y[0])for(;k<v.length;k++){var b=v[k];"-"===b[0]?w[b]=!0:w[v[k-1]]=b}else g.push(y)}switch(h){case"version":p("Moon CLI v1.0.0-beta.4");break;case"help":var x=g[0];if(x in s){var C=s[x];p("Usage: "+C.usage+"\n\t"+C.description),"parameters"in C&&p("\nParameters:\n"+m(C.parameters)),"options"in C&&p("\nOptions:\n"+m(C.options))}else{var M={};for(var R in s){var j=s[R];M[j.usage]=j.description}p("Usage: moon <command> [options]\n\nCommands:\n"+m(M))}break;case"create":n=g[0],e=w["-t"]||w["--template"]||"kbrsh/moon-template",void 0!==n&&0!==n.length||d("Invalid or unknown name.\n\nAttempted to create an application.\n\nReceived an invalid or unknown name.\n\nExpected a valid name. Run \x1b[35mmoon help create\x1b[0m to see usage information."),!0===e&&d("Invalid or unknown template.\n\nAttempted to create an application.\n\nReceived an invalid or unknown template.\n\nExpected a valid template. Run \x1b[35mmoon help create\x1b[0m to see usage information.");var I={method:"GET",host:"api.github.com",path:"/repos/"+e+"/tarball/master",headers:{"User-Agent":"Moon"}};l("Moon","Generating application"),a.get(I,(function(e){e.statusCode>=300&&e.statusCode<400&&void 0!==e.headers.location?a.get(e.headers.location,(function(e){f(e)})):f(e)}));break;default:d("Unrecognized command.\n\nAttempted to execute a command.\n\nReceived a command that does not exist:\n\t"+h+"\n\nExpected a valid command. Run \x1b[35mmoon help\x1b[0m to see valid commands.")}}();