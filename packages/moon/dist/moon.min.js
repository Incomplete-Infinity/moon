/**
 * Moon v1.0.0-beta.2
 * Copyright 2016-2019 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var P={element:0,text:1,component:2};function v(e,t,a){this.node=e,this.element=t,this.children=a}function u(e,t,a,n){this.type=e,this.name=t,this.data=a,this.children=n}function E(e,t){return void 0===e?t:e}function n(e,t,a,n){return new u(e,t,a,n)}var d,N=/^\s+$/,A=/<([\w\d-_]+)([^>]*?)(\/?)>/g,t=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,M=/&amp;|&gt;|&lt;|&nbsp;|&quot;|\\|"|\n|\r/g,r=["NaN","false","in","null","this","true","typeof","undefined","window"],C={class:"className",for:"htmlFor"},O={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n","\r":"\\r"};function q(e){var a=!0;return{value:e.replace(t,function(e,t){return void 0===t||-1!==r.indexOf(t)?e:(a=!1,"$"===t[0]?t:"md."+t)}),isStatic:a}}function a(e){e=e.trim();for(var t=[],a=0;a<e.length;){var n=e[a];if("<"===n){var r=e[a+1];if("/"===r){var i=e.indexOf(">",a+2),l=e.slice(a+2,i);0,t.push({type:"tagClose",value:l}),a=i+1;continue}if("!"===r&&"-"===e[a+2]&&"-"===e[a+3]){var o=e.indexOf("--\x3e",a+4);0,a=o+3;continue}A.lastIndex=a;var s=A.exec(e);0;for(var u=s[0],v=s[1],d=s[2],f=s[3],p={},m=0;m<d.length;m++){var c=d[m];if(!N.test(c)){for(var h="",y="true";m<d.length&&(c=d[m],!N.test(c));m++){if("="===c){y="";break}h+=c}var g=C[h];if(void 0!==g&&(h=g),0===y.length){var b=d[++m];"{"===b?b="}":y+=b,m+=1;for(var k=0;m<d.length;m++)if("{"===(c=d[m]))k+=1,y+=c;else if(c===b){if("}"!==b){y+=c,p[h]={value:y,isStatic:!0};break}if(0===k){64===h.charCodeAt(0)?p[h]={value:"["+q(y).value+",md,mc]",isStatic:!1}:p[h]=q(y);break}k-=1,y+=c}else y+=c;m+=1}else p[h]={value:y,isStatic:!0}}}t.push({type:"tagOpen",value:v,attributes:p,closed:"/"===f}),a+=u.length}else if("{"===n){var w="",D=0;for(a+=1;a<e.length;a++){var S=e[a];if("{"===S)D+=1,w+=S;else if("}"===S){if(0===D)break;D-=1,w+=S}else w+=S}t.push({type:"tagOpen",value:"text",attributes:{"":q(w)},closed:!0}),a+=1}else{for(var x="";a<e.length;a++){var E=e[a];if("<"===E||"{"===E)break;x+=E}N.test(x)||t.push({type:"tagOpen",value:"text",attributes:{"":{value:'"'+x.replace(M,function(e){return O[e]})+'"',isStatic:!0}},closed:!0})}}return t}function f(e,t,a,n){this.message=e,this.start=t,this.end=a,this.next=n}function p(e,t,a){var n=a[e],r=a[t-1],i=t-e;if(0==i)return new f("",e,t);if(1==i)return"tagOpen"===n.type&&!0===n.closed?{name:n.value,attributes:n.attributes,children:[]}:new f("",e,t);if("tagOpen"!==n.type||"tagClose"!==r.type||n.value!==r.value)return new f("",e,t);var l=function e(t,a,n){var r;if(0==a-t)return[];for(var i=t+1;i<=a;i++){var l=p(t,i,n);if(l instanceof f)r=l;else{var o=e(i,a,n);if(!(o instanceof f)){for(var s=[l],u=0;u<o.length;u++)s.push(o[u]);return s}}}return new f("",t,a,r)}(e+1,t-1,a);return l instanceof f?new f("",e,t,l):{name:n.value,attributes:n.attributes,children:l}}function i(e){var t=p(0,e.length,e);return t}function $(e,t,a,n){var r,i=F(t.children[0],t,0,a,n);if(i.isStatic){var l=n.length;n.push(i.prelude+"ms["+l+"]="+i.node+";"),r=e+"=ms["+l+"];"}else r=""+i.prelude+e+"="+i.node+";";return{clause:r,variable:i.variable}}function F(e,t,a,n,r){var i,l=e.name,o=!0,s=!0;if("element"===l)return function(e,t,a){var n=e.attributes,r=n.name,i=n.data,l=n.children,o=i.isStatic,s=r.isStatic&&o&&l.isStatic,u=i.value;if(!s&&o){var v=a.length;a.push("ms["+v+"]="+u+";"),u="ms["+v+"]"}return{prelude:"",node:"m("+P.element+","+r.value+","+u+","+l.value+")",isStatic:s,variable:t}}(e,n,r);if("if"===l)return function(e,t,a,n,r){var i="m"+n,l="",o=!0,s=$(i,e,n+1,r);if(l+="var "+i+";if("+e.attributes[""].value+"){"+s.clause+"}",n=s.variable,null!==t)for(var u=t.children,v=a+1;v<u.length;){var d=u[v];if("else-if"===d.name){var f=$(i,d,n,r);l+="else if("+d.attributes[""].value+"){"+f.clause+"}",n=f.variable,u.splice(v,1)}else{if("else"!==d.name)break;var p=$(i,d,n,r);l+="else{"+p.clause+"}",n=p.variable,o=!1,u.splice(v,1)}}if(o){var m=r.length;r.push("ms["+m+"]=m("+P.text+',"text",{"":""},[]);'),l+="else{"+i+"=ms["+m+"];}"}return{prelude:l,node:i,isStatic:!1,variable:n}}(e,t,a,n,r);if("for"===l)return function(e,t,a){var n,r,i,l="m"+t,o=e.attributes,s=o[""].value.split(","),u=E(o.name,{value:'"span"'}).value,v=E(o.data,{value:"{}",isStatic:!0}),d=o.of,f=o.in,p=F(e.children[0],e,0,t+1,a);if(t=p.variable,p.isStatic){var m=a.length;a.push(p.prelude+"ms["+m+"]="+p.node+";"),i=l+".push(ms["+m+"]);"}else i=p.prelude+l+".push("+p.node+");";if(r=void 0===d?(f=f.value,"for(var "+(n=s[0])+" in "+f+"){"+(2===s.length?"var "+s[1]+"="+f+"["+n+"];":"")+i+"}"):(d=d.value,"for(var "+(n=2===s.length?s[1]:"m"+t++)+"=0;"+n+"<"+d+".length;"+n+"++){var "+s[0]+"="+d+"["+n+"];"+i+"}"),v.isStatic){var c=a.length;a.push("ms["+c+"]="+v.value+";"),v="ms["+c+"]"}else v=v.value;return{prelude:"var "+l+"=[];"+r,node:"m("+P.element+","+u+","+v+","+l+")",isStatic:!1,variable:t}}(e,n,r);i="text"===l?P.text:l[0]===l[0].toLowerCase()?P.element:P.component;var u=e.attributes,v="",d="{",f="[",p="";for(var m in u){var c=u[m];c.isStatic||(o=!1),d+=p+'"'+m+'":'+c.value,p=","}d+="}";var h=e.children,y=[];p="";for(var g=0;g<h.length;g++){var b=F(h[g],e,g,n,r);b.isStatic||(s=!1),n=b.variable,y.push(b)}for(var k=0;k<y.length;k++){var w=y[k];if(s||!w.isStatic)v+=w.prelude,f+=p+w.node;else{var D=r.length;r.push(w.prelude+"ms["+D+"]="+w.node+";"),f+=p+"ms["+D+"]"}p=","}if(f+="]",o&&!s){var S=r.length;r.push("ms["+S+"]="+d+";"),d="ms["+S+"]"}else if(!o&&s){var x=r.length;r.push("ms["+x+"]="+f+";"),f="ms["+x+"]"}return{prelude:v,node:"m("+i+',"'+l+'",'+d+","+f+")",isStatic:o&&s,variable:n}}function l(e){var t=[],a=F(e,null,0,0,t),n=a.prelude,r=a.node;return a.isStatic?"if(ms[0]===undefined){"+n+"ms[0]="+r+";}return ms[0];":"if(ms[0]===undefined){"+t.join("")+"}"+n+"return "+r+";"}function m(e){return l(i(a(e)))}function c(e,t,a){if("ariaset"===t)for(var n in a)e.setAttribute("aria-"+n,a[n]);else{var r=e[t];for(var i in a)r[i]=a[i]}}function o(e,t,a,n){for(var r in a)if(!(r in n))switch(t){case"ariaset":e.removeAttribute("aria-"+r);break;case"dataset":delete e.dataset[t];break;default:e.style[t]=""}}var L,h={},s={},y=[],g={};var _=[],z={appendNode:0,removeNode:1,replaceNode:2,setDataEvent:3,updateDataProperty:4,updateDataText:5,updateDataEvent:6,updateDataSet:7,removeDataProperty:8,removeDataEvent:9,removeDataSet:10};function R(){}function T(e){var t,a=[];if(e.type===P.text)t=document.createTextNode(e.data[""]);else{t=document.createElement(e.name);for(var n=e.children,r=0;r<n.length;r++){var i=T(n[r]);a.push(i),t.appendChild(i.element)}var l=e.data;for(var o in l){var s=l[o];if(64===o.charCodeAt(0)){var u=t.MoonEvent;null===u&&(u=t.MoonEvent=new R),u[o]=s,t.addEventListener(o.slice(1),u)}else"ariaset"===o||"dataset"===o||"style"===o?c(t,o,s):t[o]=s}}return new v(e,t,a)}function Z(e){for(;e.type===P.component;){var t=e.name,a=h[t](n,e.data,e.children,g[t]);e.type=a.type,e.name=a.name,e.data=a.data,e.children=a.children}}function j(e){for(var t=0;t<e.length;t++){var a=e[t];switch(a.type){case z.appendNode:a.elementParent.appendChild(a.element);break;case z.removeNode:a.elementParent.removeChild(a.element);break;case z.replaceNode:a.elementParent.replaceChild(a.elementOld,a.elementNew);break;case z.setDataEvent:var n=a.elementMoonEvent,r=a.key;n[r]=a.value,a.element.addEventListener(r.slice(1),n);break;case z.updateDataProperty:a.element[a.key]=a.value;break;case z.updateDataText:a.element.data=a.text;break;case z.updateDataEvent:a.elementMoonEvent[a.key]=a.value;break;case z.updateDataSet:c(a.element,a.key,a.value);break;case z.removeDataProperty:a.element.removeAttribute(a.key);break;case z.removeDataEvent:var i=a.elementMoonEvent,l=a.key;i[l]=void 0,a.element.removeEventListener(l.slice(1),i);break;case z.removeDataSet:o(a.element,a.key,a.value,a.exclude)}}}function I(){var e=_[0];for(var t in e)s[t]=e[t];!function e(t,a,n){for(;;){var r=t.pop(),i=r.node,l=a.pop();if(Z(l),i!==l)if(r.node=l,i.type!==l.type||i.name!==l.name){var o=r.element,s=T(l),u=s.element;r.element=u,r.children=s.children,n.push({type:z.replaceNode,elementOld:o,elementNew:u,elementParent:o.parentNode})}else if(i.type===P.text){var v=l.data[""];i.data[""]!==v&&n.push({type:z.updateDataText,element:r.element,text:v})}else{var d=r.element,f=i.data,p=l.data;if(f!==p){for(var m in p){var c=f[m],h=p[m];if(c!==h)if(64===m.charCodeAt(0)){var y=d.MoonEvent;null===y&&(y=d.MoonEvent=new R),void 0===y[m]?n.push({type:z.setDataEvent,element:d,elementMoonEvent:y,key:m,value:h}):n.push({type:z.updateDataEvent,elementMoonEvent:y,key:m,value:h})}else"ariaset"===m||"dataset"===m||"style"===m?(n.push({type:z.updateDataSet,element:d,key:m,value:h}),void 0!==c&&n.push({type:z.removeDataSet,element:d,key:m,value:c,exclude:h})):n.push({type:z.updateDataProperty,element:d,key:m,value:h})}for(var g in f)g in p||(64===g.charCodeAt(0)?n.push({type:z.removeDataEvent,element:d,elementMoonEvent:d.MoonEvent,key:g}):"ariaset"===g||"dataset"===g||"style"===g?n.push({type:z.removeDataSet,element:d,key:g,value:f[g],exclude:{}}):n.push({type:z.removeDataProperty,element:d,key:g}))}var b=r.children,k=l.children;if(b!==k){var w=b.length,D=k.length;if(w===D)for(var S=0;S<w;S++)t.push(b[S]),a.push(k[S]);else if(D<w){for(var x=0;x<D;x++)t.push(b[x]),a.push(k[x]);for(var E=D;E<w;E++)n.push({type:z.removeNode,element:b.pop().element,elementParent:d})}else{for(var N=0;N<w;N++)t.push(b[N]),a.push(k[N]);for(var A=w;A<D;A++){var M=k[A];Z(M);var C=T(M);b.push(C),n.push({type:z.appendNode,element:C.element,elementParent:d})}}}}if(0===t.length){j(n),_.shift(),0!==_.length&&(16<=Date.now()-L?requestAnimationFrame(function(){L=Date.now(),I()}):I());break}if(16<=Date.now()-L){requestAnimationFrame(function(){L=Date.now(),e(t,a,n)});break}}}([d],[h.Root(n,s,y,g.Root)],[])}function b(e){_.push(e),1===_.length&&requestAnimationFrame(function(){L=Date.now(),I()})}function e(e){var t=E(e.name,"Root"),i=e.data,l=e.view;if("string"==typeof l&&(l=new Function("m","md","mc","ms",m(l))),g[t]=[],h[t]=void 0===i?l:function(e,t,a,n){for(var r in i)r in t||(t[r]=i[r]);return l(e,t,a,n)},"Root"===t){var a=e.root;"string"==typeof a&&(a=document.querySelector(a));for(var n=a.attributes,r={},o=0;o<n.length;o++){var s=n[o];r[s.name]=s.value}!function(e){d=e}(new v(new u(P.element,a.tagName.toLowerCase(),r,[]),a,[])),b(E(i,{}))}}return R.prototype.handleEvent=function(e){var t=this["@"+e.type];t[0](e,t[1],t[2])},Node.prototype.MoonEvent=null,e.lex=a,e.parse=i,e.generate=l,e.compile=m,e.components=h,e.get=s,e.set=b,e});