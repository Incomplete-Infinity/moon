/**
 * Moon v1.0.0-beta.2
 * Copyright 2016-2019 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var F={element:0,text:1,component:2};function d(e,t,a){this.node=e,this.element=t,this.children=a}function s(e,t,a,n){this.type=e,this.name=t,this.data=a,this.children=n}function n(e,t,a,n){return new s(e,t,a,n)}var N=/^\s+$/,A=/&amp;|&gt;|&lt;|&nbsp;|&quot;|\\|"|\n|\r/g,M={class:"className",for:"htmlFor"},O={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n","\r":"\\r"};function t(e){e=e.trim();for(var t=[],a=0;a<e.length;){var n=e[a];if("<"===n){var r=e[a+1];if("/"===r){var i=e.indexOf(">",a+2),l=e.slice(a+2,i);0,t.push({type:"tagClose",value:l}),a=i+1;continue}if("!"===r&&"-"===e[a+2]&&"-"===e[a+3]){var o=e.indexOf("--\x3e",a+4);0,a=o+3;continue}var u="",s="",v=!1,d={},c=!0,f=0;for(a++;a<e.length;a++){var p=e[a];if("{"===p?f+=1:"}"===p&&(f-=1),0===f&&(">"===p||"/"===p&&">"===e[a+1]&&(v=!0)&&(a+=1))){a+=1;break}c?" "===p?c=!1:"="===p?(c=!1,s+=p):u+=p:s+=p}for(var m=0;m<s.length;m++){var h=s[m];if(!N.test(h)){for(var y="",b="true";m<s.length&&(h=s[m],!N.test(h));m++){if("="===h){b="";break}y+=h}if(y in M&&(y=M[y]),0===b.length){var g=s[++m];"{"===g?g="}":b+=g,m+=1;for(var k=0;m<s.length;m++)if("{"===(h=s[m]))k+=1,b+=h;else if(h===g){if("}"!==g){b+=h,d[y]={value:b,isExpression:!1};break}if(0===k){d[y]={value:b,isExpression:!0};break}k-=1,b+=h}else b+=h}else d[y]={value:b,isExpression:!0}}}t.push({type:"tagOpen",value:u,attributes:d,closed:v})}else if("{"===n){var x="",w=0;for(a+=1;a<e.length;a++){var E=e[a];if("{"===E)w+=1,x+=E;else if("}"===E){if(0===w)break;w-=1,x+=E}else x+=E}t.push({type:"tagOpen",value:"text",attributes:{"":{value:x,isExpression:!0}},closed:!0}),a+=1}else{for(var D="";a<e.length;a++){var S=e[a];if("<"===S||"{"===S)break;D+=S}N.test(D)||t.push({type:"tagOpen",value:"text",attributes:{"":{value:'"'+D.replace(A,function(e){return O[e]})+'"',isExpression:!1}},closed:!0})}}return t}function v(e,t,a,n){this.message=e,this.start=t,this.end=a,this.next=n}function c(e,t,a){var n=a[e],r=a[t-1],i=t-e;if(0==i)return new v("",e,t);if(1==i)return"tagOpen"===n.type&&!0===n.closed?{name:n.value,attributes:n.attributes,children:[]}:new v("",e,t);if("tagOpen"!==n.type||"tagClose"!==r.type||n.value!==r.value)return new v("",e,t);var l=function e(t,a,n){var r;if(0==a-t)return[];for(var i=t+1;i<=a;i++){var l=c(t,i,n);if(l instanceof v)r=l;else{var o=e(i,a,n);if(!(o instanceof v)){for(var u=[l],s=0;s<o.length;s++)u.push(o[s]);return u}}}return new v("",t,a,r)}(e+1,t-1,a);return l instanceof v?new v("",e,t,l):{name:n.value,attributes:n.attributes,children:l}}function a(e){var t=c(0,e.length,e);return t}var D=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,S=["Infinity","NaN","break","case","catch","class","const","continue","default","delete","do","else","extends","false","finally","for","function","if","in","instanceof","let","new","null","return","super","switch","this","throw","true","try","typeof","undefined","var","void","while","window"];function C(e,t,a){var n=t.value,r=!0;return t.isExpression&&(n=n.replace(D,function(e,t){return void 0===t||-1!==S.indexOf(t)?e:(r=!1,-1!==a.indexOf(t)?t:"data"===t?"md":"children"===t?"mc":"md."+t)})),64===e.charCodeAt(0)&&(n="["+n+",md,mc]"),{value:n,isStatic:r}}function P(e,t,a,n){var r=e+t;if(r in n)return n[r];var i=n[r]="ms["+a.length+"]";return a.push(e+i+"="+t+";"),i}function q(e,t,a,n,r,i){var l=L(t.children[0],t,0,a,n,r,i);return{clause:l.isStatic?e+"="+P(l.prelude,l.node,r,i)+";":""+l.prelude+e+"="+l.node+";",variable:l.variable}}function L(e,t,a,n,r,i,l){var o,u=e.name,s=!0,v=!0;if("element"===u)return function(e,t,a,n,r){var i=e.attributes,l=C("name",i.name,a),o=C("data",i.data,a),u=C("children",i.children,a),s=o.isStatic,v=u.isStatic,d=l.isStatic&&s&&v,c=o.value,f=u.value;return d||(s&&(c=P("",c,n,r)),v&&(f=P("",f,n,r))),{prelude:"",node:"m("+F.element+","+l.value+","+c+","+f+")",isStatic:d,variable:t}}(e,n,r,i,l);if("if"===u)return function(e,t,a,n,r,i,l){var o="m"+n,u="",s=!0,v=q(o,e,n+1,r,i,l);if(u+="var "+o+";if("+C("",e.attributes[""],r).value+"){"+v.clause+"}",n=v.variable,null!==t)for(var d=t.children,c=a+1;c<d.length;){var f=d[c];if("else-if"===f.name){var p=q(o,f,n,r,i,l);u+="else if("+C("",f.attributes[""],r).value+"){"+p.clause+"}",n=p.variable,d.splice(c,1)}else{if("else"!==f.name)break;var m=q(o,f,n,r,i,l);u+="else{"+m.clause+"}",n=m.variable,s=!1,d.splice(c,1)}}return s&&(u+="else{"+o+"="+P("","m("+F.text+',"text",{"":""},[])',i,l)+";}"),{prelude:u,node:o,isStatic:!1,variable:n}}(e,t,a,n,r,i,l);if("for"===u)return function(e,t,a,n,r){for(var i,l="m"+t,o="m"+(t+1),u="m"+(t+2),s=e.attributes,v=s[""].value,d=("name"in s?s.name.value:'"span"'),c=("data"in s?C("data",s.data,a):{value:"{}",isStatic:!0});null!==(i=D.exec(v));)void 0!==(i=i[1])&&-1===S.indexOf(i)&&-1===a.indexOf(i)&&(a=a.concat([i]));var f,p,m,h,y=L(e.children[0],e,0,t+3,a,n,r);return t=y.variable,f="var "+o+"=function("+v+"){"+(f=y.isStatic?"return "+P(y.prelude,y.node,n,r)+";":y.prelude+"return "+y.node+";")+"};",h="in"in s?(m="for(var "+u+" in "+(p=C("in",s.in,a).value)+"){",u+","+p+"["+u+"]"):(m="for(var "+u+"=0;"+u+"<"+(p=C("of",s.of,a).value)+".length;"+u+"++){",p+"["+u+"],"+u),c=c.isStatic?P("",c.value,n,r):c.value,{prelude:"var "+l+"=[];"+f+m+l+".push("+o+"("+h+"));}",node:"m("+F.element+","+d+","+c+","+l+")",isStatic:!1,variable:t}}(e,n,r,i,l);o="text"===u?F.text:u[0]===u[0].toLowerCase()?F.element:F.component;var d=e.attributes,c="",f="{",p="",m="";for(var h in d){var y=C(h,d[h],r);"children"===h?(y.isStatic||(v=!1),p=y.value):(y.isStatic||(s=!1),f+=m+'"'+h+'":'+y.value,m=",")}if(f+="}",!("children"in d)){var b=e.children,g=[];p+="[",m="";for(var k=0;k<b.length;k++){var x=L(b[k],e,k,n,r,i,l);x.isStatic||(v=!1),n=x.variable,g.push(x)}for(var w=0;w<g.length;w++){var E=g[w];v||!E.isStatic?(c+=E.prelude,p+=m+E.node):p+=m+P(E.prelude,E.node,i,l),m=","}p+="]"}return s&&!v?f=P("",f,i,l):!s&&v&&(p=P("",p,i,l)),{prelude:c,node:"m("+o+',"'+u+'",'+f+","+p+")",isStatic:s&&v,variable:n}}function r(e){var t=[],a=L(e,null,0,0,[],t,{}),n=a.prelude,r=a.node;return a.isStatic?"if(!(0 in ms)){"+n+"ms[0]="+r+";}return ms[0];":"if(!(0 in ms)){"+t.join("")+"}"+n+"return "+r+";"}function f(e){return r(a(t(e)))}var p,m={};function h(e,t,a){if("ariaset"===t)for(var n in a)e.setAttribute("aria-"+n,a[n]);else{var r=e[t];for(var i in a)r[i]=a[i]}}function y(e,t,a,n){for(var r in a)if(!(r in n))switch(t){case"ariaset":e.removeAttribute("aria-"+r);break;case"dataset":delete e.dataset[r];break;default:e.style[r]=""}}var R,b={},i={},l=[],g={};var $=[],z={appendNode:0,removeNode:1,replaceNode:2,setDataEvent:3,updateDataProperty:4,updateDataText:5,updateDataEvent:6,updateDataSet:7,removeDataProperty:8,removeDataEvent:9,removeDataSet:10};function T(){}function Z(e){for(;e.type===F.component;){var t=e.name,a=b[t](n,e.data,e.children,g[t]);e.type=a.type,e.name=a.name,e.data=a.data,e.children=a.children}}function _(e){var t,a=[];if(e.type===F.text)t=document.createTextNode(e.data[""]);else{t=document.createElement(e.name);for(var n=e.children,r=0;r<n.length;r++){var i=n[r];Z(i);var l=_(i);a.push(l),t.appendChild(l.element)}var o=e.data;for(var u in o){var s=o[u];if(64===u.charCodeAt(0)){var v=t.MoonEvent;null===v&&(v=t.MoonEvent=new T),v[u]=s,t.addEventListener(u.slice(1),v)}else"ariaset"===u||"dataset"===u||"style"===u?h(t,u,s):t[u]=s}}return new d(e,t,a)}function j(e){for(var t=0;t<e.length;t++){var a=e[t];switch(a.type){case z.appendNode:a.elementParent.appendChild(a.element);break;case z.removeNode:a.elementParent.removeChild(a.element);break;case z.replaceNode:a.elementParent.replaceChild(a.elementNew,a.elementOld);break;case z.setDataEvent:var n=a.elementMoonEvent,r=a.key;n[r]=a.value,a.element.addEventListener(r.slice(1),n);break;case z.updateDataProperty:a.element[a.key]=a.value;break;case z.updateDataText:a.element.data=a.text;break;case z.updateDataEvent:a.elementMoonEvent[a.key]=a.value;break;case z.updateDataSet:h(a.element,a.key,a.value);break;case z.removeDataProperty:o=a.element,u=a.name,s=a.key,o[s]=u in m?m[u][s]:(m[u]=document.createElement(u))[s];break;case z.removeDataEvent:var i=a.elementMoonEvent,l=a.key;delete i[l],a.element.removeEventListener(l.slice(1),i);break;case z.removeDataSet:y(a.element,a.key,a.value,a.exclude)}}var o,u,s}function I(){var e=$[0];for(var t in e)i[t]=e[t];!function e(t,a,n){for(;;){var r=t.pop(),i=r.node,l=a.pop();if(Z(l),i!==l){var o=i.type,u=i.name;if(o!==(r.node=l).type||u!==l.name){var s=r.element,v=_(l),d=v.element;r.element=d,r.children=v.children,n.push({type:z.replaceNode,elementOld:s,elementNew:d,elementParent:s.parentNode})}else if(o===F.text){var c=l.data[""];i.data[""]!==c&&n.push({type:z.updateDataText,element:r.element,text:c})}else{var f=i.data,p=l.data;if(f!==p){var m=r.element;for(var h in p){var y=f[h],b=p[h];if(y!==b)if(64===h.charCodeAt(0)){var g=m.MoonEvent;null===g&&(g=m.MoonEvent=new T),h in g?n.push({type:z.updateDataEvent,elementMoonEvent:g,key:h,value:b}):n.push({type:z.setDataEvent,element:m,elementMoonEvent:g,key:h,value:b})}else"ariaset"===h||"dataset"===h||"style"===h?(n.push({type:z.updateDataSet,element:m,key:h,value:b}),h in f&&n.push({type:z.removeDataSet,element:m,key:h,value:y,exclude:b})):n.push({type:z.updateDataProperty,element:m,key:h,value:b})}for(var k in f)k in p||(64===k.charCodeAt(0)?n.push({type:z.removeDataEvent,element:m,elementMoonEvent:m.MoonEvent,key:k}):"ariaset"===k||"dataset"===k||"style"===k?n.push({type:z.removeDataSet,element:m,key:k,value:f[k],exclude:{}}):n.push({type:z.removeDataProperty,element:m,name:u,key:k}))}var x=l.children;if(i.children!==x){var w=r.element,E=r.children,D=E.length,S=x.length;if(D===S)for(var N=0;N<D;N++)t.push(E[N]),a.push(x[N]);else if(S<D){for(var A=0;A<S;A++)t.push(E[A]),a.push(x[A]);for(var M=S;M<D;M++)n.push({type:z.removeNode,element:E.pop().element,elementParent:w})}else{for(var O=0;O<D;O++)t.push(E[O]),a.push(x[O]);for(var C=D;C<S;C++){var P=x[C];Z(P);var q=_(P);E.push(q),n.push({type:z.appendNode,element:q.element,elementParent:w})}}}}}if(0===t.length){j(n),$.shift(),0!==$.length&&(16<=Date.now()-R?requestAnimationFrame(function(){R=Date.now(),I()}):I());break}if(16<=Date.now()-R){requestAnimationFrame(function(){R=Date.now(),e(t,a,n)});break}}}([p],[b.Root(n,i,l,g.Root)],[])}function k(e){$.push(e),1===$.length&&requestAnimationFrame(function(){R=Date.now(),I()})}function e(e){var t="name"in e?e.name:"Root",i=e.view;if("string"==typeof i&&(i=new Function("m","md","mc","ms",f(i))),g[t]=[],"Root"===t){var a=e.root;"string"==typeof a&&(a=document.querySelector(a)),b.Root=i;for(var n=a.attributes,r={},l=0;l<n.length;l++){var o=n[l];r[o.name]=o.value}!function(e){p=e}(new d(new s(F.element,a.tagName.toLowerCase(),r,[]),a,[])),k("data"in e?e.data:{})}else if("data"in e){var u=e.data;b[t]=function(e,t,a,n){for(var r in u)r in t||(t[r]=u[r]);return i(e,t,a,n)}}else b[t]=i}return T.prototype.handleEvent=function(e){var t=this["@"+e.type];t[0](e,t[1],t[2])},Node.prototype.MoonEvent=null,e.lex=t,e.parse=a,e.generate=r,e.compile=f,e.components=b,e.get=i,e.set=k,e});