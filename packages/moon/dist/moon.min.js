/**
 * Moon v1.0.0-beta.2
 * Copyright 2016-2019 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var $={element:0,text:1,component:2};function c(e,t,a){this.node=e,this.element=t,this.children=a}function v(e,t,a,n){this.type=e,this.name=t,this.data=a,this.children=n}function n(e,t,a,n){return new v(e,t,a,n)}var E=/^\s+$/,N=/<([\w\d-_]+)([^>]*?)(\/?)>/g,t=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,A=/&amp;|&gt;|&lt;|&nbsp;|&quot;|\\|"|\n|\r/g,r=["NaN","false","in","null","this","true","typeof","undefined","window"],M={class:"className",for:"htmlFor"},C={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n","\r":"\\r"};function P(e){var a=!0;return{value:e.replace(t,function(e,t){return void 0===t||-1!==r.indexOf(t)?e:(a=!1,"$"===t[0]?t:"children"===t?"mc":"md."+t)}),isStatic:a}}function a(e){e=e.trim();for(var t=[],a=0;a<e.length;){var n=e[a];if("<"===n){var r=e[a+1];if("/"===r){var i=e.indexOf(">",a+2),l=e.slice(a+2,i);0,t.push({type:"tagClose",value:l}),a=i+1;continue}if("!"===r&&"-"===e[a+2]&&"-"===e[a+3]){var o=e.indexOf("--\x3e",a+4);0,a=o+3;continue}N.lastIndex=a;var u=N.exec(e);0;for(var v=u[0],s=u[1],c=u[2],d=u[3],f={},p=0;p<c.length;p++){var m=c[p];if(!E.test(m)){for(var h="",y="true";p<c.length&&(m=c[p],!E.test(m));p++){if("="===m){y="";break}h+=m}if(h in M&&(h=M[h]),0===y.length){var b=c[++p];"{"===b?b="}":y+=b,p+=1;for(var g=0;p<c.length;p++)if("{"===(m=c[p]))g+=1,y+=m;else if(m===b){if("}"!==b){y+=m,f[h]={value:y,isStatic:!0};break}if(0===g){64===h.charCodeAt(0)?f[h]={value:"["+P(y).value+",md,mc]",isStatic:!1}:f[h]=P(y);break}g-=1,y+=m}else y+=m;p+=1}else f[h]={value:y,isStatic:!0}}}t.push({type:"tagOpen",value:s,attributes:f,closed:"/"===d}),a+=v.length}else if("{"===n){var k="",w=0;for(a+=1;a<e.length;a++){var D=e[a];if("{"===D)w+=1,k+=D;else if("}"===D){if(0===w)break;w-=1,k+=D}else k+=D}t.push({type:"tagOpen",value:"text",attributes:{"":P(k)},closed:!0}),a+=1}else{for(var S="";a<e.length;a++){var x=e[a];if("<"===x||"{"===x)break;S+=x}E.test(S)||t.push({type:"tagOpen",value:"text",attributes:{"":{value:'"'+S.replace(A,function(e){return C[e]})+'"',isStatic:!0}},closed:!0})}}return t}function s(e,t,a,n){this.message=e,this.start=t,this.end=a,this.next=n}function d(e,t,a){var n=a[e],r=a[t-1],i=t-e;if(0==i)return new s("",e,t);if(1==i)return"tagOpen"===n.type&&!0===n.closed?{name:n.value,attributes:n.attributes,children:[]}:new s("",e,t);if("tagOpen"!==n.type||"tagClose"!==r.type||n.value!==r.value)return new s("",e,t);var l=function e(t,a,n){var r;if(0==a-t)return[];for(var i=t+1;i<=a;i++){var l=d(t,i,n);if(l instanceof s)r=l;else{var o=e(i,a,n);if(!(o instanceof s)){for(var u=[l],v=0;v<o.length;v++)u.push(o[v]);return u}}}return new s("",t,a,r)}(e+1,t-1,a);return l instanceof s?new s("",e,t,l):{name:n.value,attributes:n.attributes,children:l}}function i(e){var t=d(0,e.length,e);return t}function S(e,t,a,n){var r=e+t;if(r in n)return n[r];var i=n[r]="ms["+a.length+"]";return a.push(e+i+"="+t+";"),i}function x(e,t,a,n,r){var i=O(t.children[0],t,0,a,n,r);return{clause:i.isStatic?e+"="+S(i.prelude,i.node,n,r)+";":""+i.prelude+e+"="+i.node+";",variable:i.variable}}function O(e,t,a,n,r,i){var l,o=e.name,u=!0,v=!0;if("element"===o)return function(e,t,a,n){var r=e.attributes,i=r.name,l=r.data,o=r.children,u=l.isStatic,v=o.isStatic,s=i.isStatic&&u&&v,c=l.value,d=o.value;return s||(u&&(c=S("",c,a,n)),v&&(d=S("",d,a,n))),{prelude:"",node:"m("+$.element+","+i.value+","+c+","+d+")",isStatic:s,variable:t}}(e,n,r,i);if("if"===o)return function(e,t,a,n,r,i){var l="m"+n,o="",u=!0,v=x(l,e,n+1,r,i);if(o+="var "+l+";if("+e.attributes[""].value+"){"+v.clause+"}",n=v.variable,null!==t)for(var s=t.children,c=a+1;c<s.length;){var d=s[c];if("else-if"===d.name){var f=x(l,d,n,r,i);o+="else if("+d.attributes[""].value+"){"+f.clause+"}",n=f.variable,s.splice(c,1)}else{if("else"!==d.name)break;var p=x(l,d,n,r,i);o+="else{"+p.clause+"}",n=p.variable,u=!1,s.splice(c,1)}}return u&&(o+="else{"+l+"="+S("","m("+$.text+',"text",{"":""},[])',r,i)+";}"),{prelude:o,node:l,isStatic:!1,variable:n}}(e,t,a,n,r,i);if("for"===o)return function(e,t,a,n){var r,i,l="m"+t,o=e.attributes,u=o[""].value.split(","),v="name"in o?o.name.value:'"span"',s="data"in o?o.data:{value:"{}",isStatic:!0},c=O(e.children[0],e,0,t+1,a,n);if(t=c.variable,i=c.isStatic?l+".push("+S(c.prelude,c.node,a,n)+");":c.prelude+l+".push("+c.node+");","in"in o){var d=o.in.value,f=u[0];r="for(var "+f+" in "+d+"){"+(2===u.length?"var "+u[1]+"="+d+"["+f+"];":"")+i+"}"}else{var p=o.of.value,m=2===u.length?u[1]:"m"+t++;r="for(var "+m+"=0;"+m+"<"+p+".length;"+m+"++){var "+u[0]+"="+p+"["+m+"];"+i+"}"}return s=s.isStatic?S("",s.value,a,n):s.value,{prelude:"var "+l+"=[];"+r,node:"m("+$.element+","+v+","+s+","+l+")",isStatic:!1,variable:t}}(e,n,r,i);l="text"===o?$.text:o[0]===o[0].toLowerCase()?$.element:$.component;var s=e.attributes,c="",d="{",f="",p="";for(var m in s){var h=s[m];"children"===m?(h.isStatic||(v=!1),f=h.value):(h.isStatic||(u=!1),d+=p+'"'+m+'":'+h.value,p=",")}if(d+="}",!("children"in s)){var y=e.children,b=[];f+="[",p="";for(var g=0;g<y.length;g++){var k=O(y[g],e,g,n,r,i);k.isStatic||(v=!1),n=k.variable,b.push(k)}for(var w=0;w<b.length;w++){var D=b[w];v||!D.isStatic?(c+=D.prelude,f+=p+D.node):f+=p+S(D.prelude,D.node,r,i),p=","}f+="]"}return u&&!v?d=S("",d,r,i):!u&&v&&(f=S("",f,r,i)),{prelude:c,node:"m("+l+',"'+o+'",'+d+","+f+")",isStatic:u&&v,variable:n}}function l(e){var t=[],a=O(e,null,0,0,t,{}),n=a.prelude,r=a.node;return a.isStatic?"if(!(0 in ms)){"+n+"ms[0]="+r+";}return ms[0];":"if(!(0 in ms)){"+t.join("")+"}"+n+"return "+r+";"}function f(e){return l(i(a(e)))}var p,m={};function h(e,t,a){if("ariaset"===t)for(var n in a)e.setAttribute("aria-"+n,a[n]);else{var r=e[t];for(var i in a)r[i]=a[i]}}function y(e,t,a,n){for(var r in a)if(!(r in n))switch(t){case"ariaset":e.removeAttribute("aria-"+r);break;case"dataset":delete e.dataset[r];break;default:e.style[r]=""}}var F,b={},o={},u=[],g={};var L=[],R={appendNode:0,removeNode:1,replaceNode:2,setDataEvent:3,updateDataProperty:4,updateDataText:5,updateDataEvent:6,updateDataSet:7,removeDataProperty:8,removeDataEvent:9,removeDataSet:10};function _(){}function z(e){for(;e.type===$.component;){var t=e.name,a=b[t](n,e.data,e.children,g[t]);e.type=a.type,e.name=a.name,e.data=a.data,e.children=a.children}}function T(e){var t,a=[];if(e.type===$.text)t=document.createTextNode(e.data[""]);else{t=document.createElement(e.name);for(var n=e.children,r=0;r<n.length;r++){var i=n[r];z(i);var l=T(i);a.push(l),t.appendChild(l.element)}var o=e.data;for(var u in o){var v=o[u];if(64===u.charCodeAt(0)){var s=t.MoonEvent;null===s&&(s=t.MoonEvent=new _),s[u]=v,t.addEventListener(u.slice(1),s)}else"ariaset"===u||"dataset"===u||"style"===u?h(t,u,v):t[u]=v}}return new c(e,t,a)}function Z(e){for(var t=0;t<e.length;t++){var a=e[t];switch(a.type){case R.appendNode:a.elementParent.appendChild(a.element);break;case R.removeNode:a.elementParent.removeChild(a.element);break;case R.replaceNode:a.elementParent.replaceChild(a.elementNew,a.elementOld);break;case R.setDataEvent:var n=a.elementMoonEvent,r=a.key;n[r]=a.value,a.element.addEventListener(r.slice(1),n);break;case R.updateDataProperty:a.element[a.key]=a.value;break;case R.updateDataText:a.element.data=a.text;break;case R.updateDataEvent:a.elementMoonEvent[a.key]=a.value;break;case R.updateDataSet:h(a.element,a.key,a.value);break;case R.removeDataProperty:o=a.element,u=a.name,v=a.key,s=void 0,s=u in m?m[u]:m[u]={},o[v]=v in s?s[v]:s[v]=document.createElement(u)[v];break;case R.removeDataEvent:var i=a.elementMoonEvent,l=a.key;delete i[l],a.element.removeEventListener(l.slice(1),i);break;case R.removeDataSet:y(a.element,a.key,a.value,a.exclude)}}var o,u,v,s}function j(){var e=L[0];for(var t in e)o[t]=e[t];!function e(t,a,n){for(;;){var r=t.pop(),i=r.node,l=a.pop();if(z(l),i!==l){var o=i.type,u=i.name;if(o!==(r.node=l).type||u!==l.name){var v=r.element,s=T(l),c=s.element;r.element=c,r.children=s.children,n.push({type:R.replaceNode,elementOld:v,elementNew:c,elementParent:v.parentNode})}else if(o===$.text){var d=l.data[""];i.data[""]!==d&&n.push({type:R.updateDataText,element:r.element,text:d})}else{var f=i.data,p=l.data;if(f!==p){var m=r.element;for(var h in p){var y=f[h],b=p[h];if(y!==b)if(64===h.charCodeAt(0)){var g=m.MoonEvent;null===g&&(g=m.MoonEvent=new _),h in g?n.push({type:R.updateDataEvent,elementMoonEvent:g,key:h,value:b}):n.push({type:R.setDataEvent,element:m,elementMoonEvent:g,key:h,value:b})}else"ariaset"===h||"dataset"===h||"style"===h?(n.push({type:R.updateDataSet,element:m,key:h,value:b}),h in f&&n.push({type:R.removeDataSet,element:m,key:h,value:y,exclude:b})):n.push({type:R.updateDataProperty,element:m,key:h,value:b})}for(var k in f)k in p||(64===k.charCodeAt(0)?n.push({type:R.removeDataEvent,element:m,elementMoonEvent:m.MoonEvent,key:k}):"ariaset"===k||"dataset"===k||"style"===k?n.push({type:R.removeDataSet,element:m,key:k,value:f[k],exclude:{}}):n.push({type:R.removeDataProperty,element:m,name:u,key:k}))}var w=l.children;if(i.children!==w){var D=r.element,S=r.children,x=S.length,E=w.length;if(x===E)for(var N=0;N<x;N++)t.push(S[N]),a.push(w[N]);else if(E<x){for(var A=0;A<E;A++)t.push(S[A]),a.push(w[A]);for(var M=E;M<x;M++)n.push({type:R.removeNode,element:S.pop().element,elementParent:D})}else{for(var C=0;C<x;C++)t.push(S[C]),a.push(w[C]);for(var P=x;P<E;P++){var O=w[P];z(O);var q=T(O);S.push(q),n.push({type:R.appendNode,element:q.element,elementParent:D})}}}}}if(0===t.length){Z(n),L.shift(),0!==L.length&&(16<=Date.now()-F?requestAnimationFrame(function(){F=Date.now(),j()}):j());break}if(16<=Date.now()-F){requestAnimationFrame(function(){F=Date.now(),e(t,a,n)});break}}}([p],[b.Root(n,o,u,g.Root)],[])}function k(e){L.push(e),1===L.length&&requestAnimationFrame(function(){F=Date.now(),j()})}function e(e){var t="name"in e?e.name:"Root",i=e.view;if("string"==typeof i&&(i=new Function("m","md","mc","ms",f(i))),g[t]=[],"Root"===t){var a=e.root;"string"==typeof a&&(a=document.querySelector(a)),b.Root=i;for(var n=a.attributes,r={},l=0;l<n.length;l++){var o=n[l];r[o.name]=o.value}!function(e){p=e}(new c(new v($.element,a.tagName.toLowerCase(),r,[]),a,[])),k("data"in e?e.data:{})}else if("data"in e){var u=e.data;b[t]=function(e,t,a,n){for(var r in u)r in t||(t[r]=u[r]);return i(e,t,a,n)}}else b[t]=i}return _.prototype.handleEvent=function(e){var t=this["@"+e.type];t[0](e,t[1],t[2])},Node.prototype.MoonEvent=null,e.lex=a,e.parse=i,e.generate=l,e.compile=f,e.components=b,e.get=o,e.set=k,e});