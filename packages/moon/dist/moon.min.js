/**
 * Moon v1.0.0-beta.2
 * Copyright 2016-2019 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var S={element:0,text:1,component:2};function w(e,t){return void 0===e?t:e}var N,D=/^\s+$/,A=/<([\w\d-_]+)([^>]*?)(\/?)>/g,t=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,C=/&amp;|&gt;|&lt;|&nbsp;|&quot;|\\|"|\n|\r/g,n=["NaN","false","in","null","this","true","typeof","undefined","window"],P={class:"className",for:"htmlFor"},L={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n","\r":"\\r"};function M(e){var a=!0;return{value:e.replace(t,function(e,t){return void 0===t||-1!==n.indexOf(t)?e:(a=!1,"$"===t[0]?t:"data."+t)}),isStatic:a}}function a(e){e=e.trim();for(var t=[],a=0;a<e.length;){var n=e[a];if("<"===n){var r=e[a+1];if("/"===r){var o=e.indexOf(">",a+2),i=e.slice(a+2,o);0,t.push({type:"tagClose",value:i}),a=o+1;continue}if("!"===r&&"-"===e[a+2]&&"-"===e[a+3]){var l=e.indexOf("--\x3e",a+4);0,a=l+3;continue}A.lastIndex=a;var d=A.exec(e);0;for(var u=d[0],v=d[1],s=d[2],f=d[3],c={},p=0;p<s.length;p++){var m=s[p];if(!D.test(m)){for(var h="",y="true";p<s.length&&(m=s[p],!D.test(m));p++){if("="===m){y="";break}h+=m}var g=P[h];if(void 0!==g&&(h=g),0===y.length){var w=s[++p];"{"===w?w="}":y+=w,p+=1;for(var N=0;p<s.length;p++)if("{"===(m=s[p]))N+=1,y+=m;else if(m===w){if("}"!==w){y+=m,c[h]={value:y,isStatic:!0};break}if(0===N){64===h.charCodeAt(0)?c[h]={value:"["+M(y).value+",data]",isStatic:!1}:c[h]=M(y);break}y+=m,N-=1}else y+=m;p+=1}else c[h]={value:y,isStatic:!0}}}t.push({type:"tagOpen",value:v,attributes:c,closed:"/"===f}),a+=u.length}else if("{"===n){var b="",O=0;for(a+=1;a<e.length;a++){var k=e[a];if("{"===k)O+=1,b+=k;else if("}"===k){if(0===O)break;O-=1,b+=k}else b+=k}t.push({type:"tagOpen",value:"text",attributes:{"":M(b)},closed:!0}),a+=1}else{for(var x="";a<e.length;a++){var E=e[a];if("<"===E||"{"===E)break;x+=E}D.test(x)||t.push({type:"tagOpen",value:"text",attributes:{"":{value:'"'+x.replace(C,function(e){return L[e]})+'"',isStatic:!0}},closed:!0})}}return t}function v(e,t,a,n){this.message=e,this.start=t,this.end=a,this.next=n}function s(e,t,a){var n=a[e],r=a[t-1],o=t-e;if(0==o)return new v("",e,t);if(1==o)return"tagOpen"===n.type&&!0===n.closed?{name:n.value,attributes:n.attributes,children:[]}:new v("",e,t);if("tagOpen"!==n.type||"tagClose"!==r.type||n.value!==r.value)return new v("",e,t);var i=function e(t,a,n){var r;if(0==a-t)return[];for(var o=t+1;o<=a;o++){var i=s(t,o,n);if(i instanceof v)r=i;else{var l=e(o,a,n);if(!(l instanceof v)){for(var d=[i],u=0;u<l.length;u++)d.push(l[u]);return d}}}return new v("",t,a,r)}(e+1,t-1,a);return i instanceof v?new v("",e,t,i):{name:n.value,attributes:n.attributes,children:i}}function r(e){var t=s(0,e.length,e);return t}function b(e){N=e}function O(e,t,a){var n,r=k(t.children[0],t,0,a);return r.isStatic?(n=e+"=m["+a.length+"];",a.push(r)):n=""+r.prelude+e+"="+r.node+";",n}function k(e,t,a,n){var r,o=e.name,i=!0;if("if"===o)return function(e,t,a,n){var r="m"+N,o="",i=!0;if(b(N+1),o+="var "+r+";if("+e.attributes[""].value+"){"+O(r,e,n)+"}",null!==t)for(var l=t.children,d=a+1;d<l.length;){var u=l[d];if("else-if"===u.name)o+="else if("+u.attributes[""].value+"){"+O(r,u,n)+"}",l.splice(d,1);else{if("else"!==u.name)break;o+="else{"+O(r,u,n)+"}",i=!1,l.splice(d,1)}}return i&&(o+="else{"+r+"=m["+n.length+"];}",n.push({prelude:"",node:"{type:"+S.text+',name:"text",data:{"":"",children:[]}}',isStatic:!0})),{prelude:o,node:r,isStatic:!1}}(e,t,a,n);if("for"===o)return function(e,t){var a,n,r="m"+N,o=e.attributes,i=o[""].value.split(","),l=w(o.name,{value:'"span"'}).value,d=w(o.data,{value:"{}"}).value,u=o.of,v=o.in;b(N+1);var s,f=k(e.children[0],e,0,t);return f.isStatic?(s=r+".children.push(m["+t.length+"]);",t.push(f)):s=f.prelude+r+".children.push("+f.node+");",n=void 0===u?(v=v.value,"for(var "+(a=i[0])+" in "+v+"){"+(2===i.length?"var "+i[1]+"="+v+"["+a+"];":"")+s+"}"):(u=u.value,"for(var "+(a=2===i.length?i[1]:"mi")+"=0;"+a+"<"+u+".length;"+a+"++){var "+i[0]+"="+u+"["+a+"];"+s+"}"),{prelude:"var "+r+"="+d+";"+r+".children=[];"+n,node:"{type:"+S.element+",name:"+l+",data:"+r+"}",isStatic:!1}}(e,n);r="text"===o?S.text:o[0]===o[0].toLowerCase()?S.element:S.component;var l=e.attributes,d="",u="{",v="";for(var s in l){var f=l[s];"@"!==s[0]&&f.isStatic||(i=!1),u+=v+'"'+s+'":'+f.value,v=","}if(void 0===l.children){var c=e.children,p=[];u+=v+"children:[",v="";for(var m=0;m<c.length;m++){var h=k(c[m],e,m,n);h.isStatic||(i=!1),p.push(h)}for(var y=0;y<p.length;y++){var g=p[y];i||!g.isStatic?(d+=g.prelude,u+=v+g.node):(u+=v+"m["+n.length+"]",n.push(g)),v=","}u+="]"}return{prelude:d,node:"{type:"+r+',name:"'+o+'",data:'+u+"}}",isStatic:i}}function o(e){var t=[];b(0);var a=k(e,null,0,t),n=a.prelude,r=a.node;if(a.isStatic)return"if(m[0]===undefined){"+n+"m[0]="+r+";}return m[0];";if(0===t.length)return n+"return "+r+";";for(var o="if(m[0]===undefined){",i=0;i<t.length;i++){var l=t[i];o+=l.prelude+"m["+i+"]="+l.node+";"}return""+(o+="}")+n+"return "+r+";"}function u(e){return o(r(a(e)))}function y(e,t,a){if("ariaset"===e)for(var n in t)a.setAttribute("aria-"+n,t[n]);else{var r=a[e];for(var o in t)r[o]=t[o]}}function g(e,t,a,n){for(var r in t)if(!(r in a))switch(e){case"ariaset":n.removeAttribute("aria-"+r);break;case"dataset":delete n.dataset[e];break;default:n.style[e]=""}}function x(a,e,n,t,r){n[a]=e,r.addEventListener(a.slice(1),t[a]=function(e){var t=n[a];t[0](e,t[1])})}var f,c,q,i={},p={},m={};var E=[],T={updateText:0,updateNode:1,updateDataEvent:2,updateDataSet:3,updateDataProperty:4,removeDataEvent:5,removeDataSet:6,removeDataSetExclude:7,removeDataProperty:8,appendNode:9,removeNode:10,replaceNode:11};function $(e){var t,a=[];if(e.type===S.text)t=document.createTextNode(e.data[""]);else{var n=e.data;t=document.createElement(e.name);for(var r=n.children,o=0;o<r.length;o++){var i=$(r[o]);t.appendChild(i.element),a.push(i)}var l=t.MoonEvents={},d=t.MoonListeners={};for(var u in n){var v=n[u];64===u.charCodeAt(0)?x(u,v,l,d,t):"ariaset"===u||"dataset"===u||"style"===u?y(u,v,t):"children"!==u&&(t[u]=v)}}return{element:t,node:e,children:a}}function F(e){for(;e.type===S.component;)e=p[e.name](e.data);return e}function _(e){for(var t=0;t<e.length;t++){var a=e[t];switch(a.type){case T.updateText:var n=a.nodeOld;n.element.data=a.nodeNewText,n.node=a.nodeNew;break;case T.updateNode:a.nodeOld.node=a.nodeNew;break;case T.updateDataEvent:var r=a.keyNew,o=a.nodeOldElement,i=o.MoonEvents;void 0===i[r]?x(r,a.valueNew,i,o.MoonListeners,o):i[r]=a.valueNew;break;case T.updateDataSet:y(a.keyNew,a.valueNew,a.nodeOldElement);break;case T.updateDataProperty:a.nodeOldElement[a.keyNew]=a.valueNew;break;case T.removeDataEvent:var l=a.keyOld,d=a.nodeOldElement,u=d.MoonListeners;d.removeEventListener(u[l]),delete d.MoonEvents[l],delete u[l];break;case T.removeDataSet:g(a.keyOld,a.valueOld,{},a.nodeOldElement);break;case T.removeDataSetExclude:g(a.keyOld,a.valueOld,a.valueNew,a.nodeOldElement);break;case T.removeDataProperty:a.nodeOldElement.removeAttribute(a.keyOld);break;case T.appendNode:var v=a.nodeParent,s=a.nodeOldNew;v.element.appendChild(s.element),v.children.push(s);break;case T.removeNode:var f=a.nodeParent;f.element.removeChild(f.children.pop().element);break;case T.replaceNode:var c=a.nodeOld,p=c.element,m=a.nodeOldNew,h=m.element;p.parentNode.replaceChild(h,p),c.element=h,c.node=m.node,c.children=m.children}}E.shift(),0!==E.length&&(16<=performance.now()-q?requestAnimationFrame(function(){q=performance.now(),z()}):z())}function z(){var e=E[0];for(var t in e)i[t]=e[t];!function e(t,a,n){for(;;){var r=t.pop(),o=r.node,i=F(a.pop());if(o!==i)if(o.type!==i.type||o.name!==i.name)n.push({type:T.replaceNode,nodeOld:r,nodeOldNew:$(i)});else if(o.type===S.text){var l=i.data[""];o.data[""]!==l&&n.push({type:T.updateText,nodeOld:r,nodeNew:i,nodeNewText:l})}else{n.push({type:T.updateNode,nodeOld:r,nodeNew:i});var d=r.element,u=o.data,v=i.data;for(var s in v){var f=u[s],c=v[s];if(f!==c&&"children"!==s){var p=void 0;64===s.charCodeAt(0)?p=T.updateDataEvent:"ariaset"===s||"dataset"===s||"style"===s?(p=T.updateDataSet,void 0!==f&&n.push({type:T.removeDataSetExclude,keyNew:s,valueOld:f,valueNew:c,nodeOldElement:d})):p=T.updateDataProperty,n.push({type:p,keyNew:s,valueNew:c,nodeOldElement:d})}}for(var m in u)if(!(m in v)){var h=void 0;h=64===m.charCodeAt(0)?T.removeDataEvent:"ariaset"===m||"dataset"===m||"style"===m?T.removeDataSet:T.removeDataProperty,n.push({type:h,keyOld:m,valueOld:u[m],nodeOldElement:d})}var y=r.children,g=v.children,w=y.length,N=g.length;if(w===N)for(var b=0;b<w;b++)t.push(y[b]),a.push(g[b]);else if(N<w){for(var O=0;O<N;O++)t.push(y[O]),a.push(g[O]);for(var k=N;k<w;k++)n.push({type:T.removeNode,nodeParent:r})}else{for(var x=0;x<w;x++)t.push(y[x]),a.push(g[x]);for(var E=w;E<N;E++)n.push({type:T.appendNode,nodeOldNew:$(F(g[E])),nodeParent:r})}}if(0===t.length){_(n);break}if(16<=performance.now()-q){requestAnimationFrame(function(){q=performance.now(),e(t,a,n)});break}}}([f],[c(i)],[])}function h(e){E.push(e),1===E.length&&requestAnimationFrame(function(){q=performance.now(),z()})}function e(t){var a=w(t.name,"Root");delete t.name;var n=t.view;delete t.view,"string"==typeof n&&(n=new Function("m","data",u(n))),m[a]=[];function e(e){return n(m[a],function(e,t){for(var a in t)a in e||(e[a]=t[a]);return e}(e,t))}if("Root"===a){var r="string"==typeof t.root?document.querySelector(t.root):t.root;delete t.root;for(var o=r.attributes,i={children:[]},l=0;l<o.length;l++){var d=o[l];i[d.name]=d.value}!function(e){f=e}({element:r,node:{type:S.element,name:r.tagName.toLowerCase(),data:i},children:[]}),function(e){c=e}(e),h(t)}else p[a]=e}return e.lex=a,e.parse=r,e.generate=o,e.compile=u,e.components=p,e.get=i,e.set=h,e});