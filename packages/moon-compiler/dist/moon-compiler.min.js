/**
 * Moon Compiler v1.0.0-beta.4
 * Copyright 2016-2019 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,a){"undefined"==typeof module?e.MoonCompiler=a():module.exports=a()}(this,function(){"use strict";var C=/^\s+$/;function Z(e,a){return"\\"!==a&&('"'===e||"'"===e||"`"===e)}var t=/"[^"]*"|'[^']*'|`[^`]*`|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,_=/&amp;|&gt;|&lt;|&nbsp;|&quot;|\\|"|\n|\r/g,i=["Infinity","NaN","break","case","catch","class","const","continue","default","delete","do","else","extends","false","finally","for","function","if","in","instanceof","let","new","null","return","super","switch","this","throw","true","try","typeof","undefined","var","void","while","window"],I={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n","\r":"\\r"};function P(e){for(var a;null!==(a=t.exec(e));){var r=a[1];if(void 0!==r&&-1===i.indexOf(r))return t.lastIndex=0,!1}return!(t.lastIndex=0)}function y(e){e=e.trim();for(var a=[],r=0;r<e.length;){var t=e[r];if("<"===t){var i=e[r+1];if("/"===i){var n=e.indexOf(">",r+2),l=e.slice(r+2,n);0,a.push({type:"tagClose",value:l}),r=n+1;continue}if("!"===i&&"-"===e[r+2]&&"-"===e[r+3]){var v=e.indexOf("--\x3e",r+4);0,r=v+3;continue}var f="",u="",s=!1,o={},c=!0,b=0;for(r++;r<e.length;r++){var d=e[r];if("{"===d?b+=1:"}"===d&&(b-=1),0===b&&(">"===d||"/"===d&&">"===e[r+1]&&(s=!0)&&(r+=1))){r+=1;break}if(c)C.test(d)?c=!1:"="===d?(c=!1,u+=d):f+=d;else if(Z(d,e[r-1]))for(u+=d,r++;r<e.length;r++){var h=e[r];if(u+=h,Z(h,e[r-1])&&h===d)break}else u+=d}for(var p=0;p<u.length;p++){var g=u[p];if(!C.test(g)){for(var S="",m="true";p<u.length&&(g=u[p],!C.test(g));p++){if("="===g){m="";break}S+=g}if(0===m.length){var w=u[++p];"{"===w?w="}":m+=w,p+=1;for(var k=0;p<u.length;p++)if("{"===(g=u[p]))k+=1,m+=g;else if("}"===w&&Z(g,u[p-1]))for(m+=g,p++;p<u.length;p++){var x=u[p];if(m+=x,Z(x,u[p-1])&&x===g)break}else if(g===w){if("}"!==w){m+=g,o[S]={value:m,isStatic:!0};break}if(0===k){o[S]={value:m,isStatic:P(m)};break}k-=1,m+=g}else m+=g}else o[S]={value:m,isStatic:!0}}}a.push({type:"tagOpen",value:f,attributes:o,closed:s})}else if("{"===t){var y="",O=0;for(r++;r<e.length;r++){var M=e[r];if("{"===M)O+=1,y+=M;else if("}"===M){if(0===O)break;O-=1,y+=M}else if(Z(M,e[r-1]))for(y+=M,r++;r<e.length;r++){var $=e[r];if(y+=$,Z($,e[r-1])&&$===M)break}else y+=M}a.push({type:"tagOpen",value:"text",attributes:{"":{value:y,isStatic:P(y)}},closed:!0}),r+=1}else{for(var z="";r<e.length;r++){var A=e[r];if("<"===A||"{"===A)break;z+=A}C.test(z)||a.push({type:"tagOpen",value:"text",attributes:{"":{value:'"'+z.replace(_,function(e){return I[e]})+'"',isStatic:!0}},closed:!0})}}return a}function s(e,a,r,t){this.message=e,this.start=a,this.end=r,this.next=t}function o(e,a,r){var t=r[e],i=r[a-1],n=a-e;if(0==n)return new s("",e,a);if(1==n)return"tagOpen"===t.type&&!0===t.closed?{name:t.value,attributes:t.attributes,children:[]}:new s("",e,a);if("tagOpen"!==t.type||"tagClose"!==i.type||t.value!==i.value)return new s("",e,a);var l=function e(a,r,t){var i;if(0==r-a)return[];for(var n=a+1;n<=r;n++){var l=o(a,n,t);if(l instanceof s)i=l;else{var v=e(n,r,t);if(!(v instanceof s)){for(var f=[l],u=0;u<v.length;u++)f.push(v[u]);return f}}}return new s("",a,r,i)}(e+1,a-1,r);return l instanceof s?new s("",e,a,l):{name:t.value,attributes:t.attributes,children:l}}function O(e){var a=o(0,e.length,e);return a}function $(e,a,r,t,i){var n=e+a;if(n in i)return{variable:r,variableStatic:i[n]};var l=i[n]="m"+r++;return t.push({variableStatic:l,variablePart:e+l+"="+a+";"}),{variable:r,variableStatic:l}}function z(e,a,r,t,i){var n,l=A(a.children[0],a,0,r,t,i);if(r=l.variable,l.isStatic){var v=$(l.prelude,l.node,r,t,i);r=v.variable,n=e+"="+v.variableStatic+";"}else n=""+l.prelude+e+"="+l.node+";";return{clause:n,variable:r}}function A(e,a,r,t,i,n){var l=e.name,v=!0,f=!0;if("element"===l)return function(e,a){var r=e.attributes,t=r.name,i=r.data,n=r.children;return{prelude:"",node:"Moon.view.m("+t.value+","+i.value+","+n.value+")",isStatic:t.isStatic&&i.isStatic&&n.isStatic,variable:a}}(e,t);if("if"===l)return function(e,a,r,t,i,n){var l="m"+t,v="",f=!0,u=z(l,e,t+1,i,n);if(v+="if("+e.attributes[""].value+"){"+u.clause+"}",t=u.variable,null!==a)for(var s=a.children,o=r+1;o<s.length;){var c=s[o];if("else-if"===c.name){var b=z(l,c,t,i,n);v+="else if("+c.attributes[""].value+"){"+b.clause+"}",t=b.variable,s.splice(o,1)}else{if("else"!==c.name)break;var d=z(l,c,t,i,n);v+="else{"+d.clause+"}",t=d.variable,f=!1,s.splice(o,1)}}if(f){var h=$("",'Moon.view.m("text",{"":""},[])',t,i,n);t=h.variable,v+="else{"+l+"="+h.variableStatic+";}"}return{prelude:v,node:l,isStatic:!1,variable:t}}(e,a,r,t,i,n);if("for"===l)return function(e,a,r,t){var i,n,l,v,f,u="m"+a,s="m"+(a+1),o="m"+(a+2),c=e.attributes,b=c[""].value,d=A(e.children[0],e,0,a+3,r,t);if(a=d.variable,d.isStatic){var h=$(d.prelude,d.node,a,r,t);a=h.variable,i="return "+h.variableStatic+";"}else i=d.prelude+"return "+d.node+";";if(i=s+"=function("+b+"){"+i+"};",v="in"in c?(l="for("+o+" in "+(n=c.in.value)+"){",o+","+n+"["+o+"]"):(l="for("+o+"=0;"+o+"<"+(n=c.of.value)+".length;"+o+"++){",n+"["+o+"],"+o),"data"in c)f=c.data.value;else{var p=$("","{}",a,r,t);a=p.variable,f=p.variableStatic}return{prelude:u+"=[];"+i+l+u+".push("+s+"("+v+"));}",node:"Moon.view.m("+("name"in c?c.name.value:'"span"')+","+f+","+u+")",isStatic:!1,variable:a}}(e,t,i,n);var u=e.attributes,s="",o="",c="",b="",d="";for(var h in u){var p=u[h];"children"===h?(p.isStatic||(f=!1),c=p.value):(p.isStatic||(v=!1),o+=b+'"'+h+'":'+p.value,b=",")}if(!("children"in u)){var g=e.children,S=[];c+="[";for(var m=0;m<g.length;m++){var w=A(g[m],e,m,t,i,n);w.isStatic||(f=!1),t=w.variable,S.push(w)}for(var k=0;k<S.length;k++){var x=S[k];if(f||!x.isStatic)s+=x.prelude,c+=d+x.node;else{var y=$(x.prelude,x.node,t,i,n);t=y.variable,c+=d+y.variableStatic}d=","}c+="]"}if(!v&&f){var O=$("",c,t,i,n);t=O.variable,c=O.variableStatic}if(l[0]===l[0].toUpperCase())return{prelude:s,node:l+"({"+o+b+"children:"+c+"})",isStatic:v&&f,variable:t};if(o="{"+o+"}",v&&!f){var M=$("",o,t,i,n);t=M.variable,o=M.variableStatic}return{prelude:s,node:'Moon.view.m("'+l+'",'+o+","+c+")",isStatic:v&&f,variable:t}}function M(e){for(var a=0,r=0;r<e.length;r++)"\n"===e[r]&&(a+=1);return a}return{compile:function(e){for(var a="",r=0,t=0;t<e.length;){var i=e[t];if("("===i){for(a+=i,t++;t<e.length;t++){var n=e[t];if(!C.test(n))break;a+=n}if("<"===e[t]){for(var l="",v=0;t<e.length;){var f=e[t];if(")"===f&&0===v)break;if(Z(f,e[t-1]))for(l+=f,t++;t<e.length;t++){var u=e[t];if(l+=u,Z(u,e[t-1])&&u===f){t+=1;break}}else"("===f?v+=1:")"===f&&(v-=1),l+=f,t+=1}var s=[],o={},c=A(O(y(l)),null,0,r,s,o),b=void 0;if(r=c.variable,c.isStatic){var d=$(c.prelude,c.node,r,s,o);r=d.variable,b="(function(){if("+d.variableStatic+"===undefined){"+s[0].variablePart+"}return "+d.variableStatic+";})()"}else b="(function(){"+(0===s.length?"":"if("+s[0].variableStatic+"===undefined){"+s.map(function(e){return e.variablePart}).join("")+"}")+c.prelude+"return "+c.node+";})()";a+=b;for(var h=M(l)-M(b),p=0;p<h;p++)a+="\n"}}else if(Z(i,e[t-1]))for(a+=i,t++;t<e.length;t++){var g=e[t];if(a+=g,Z(g,e[t-1])&&g===i){t+=1;break}}else if("/"===i&&"/"===e[t+1])for(;t<e.length;t++){var S=e[t];if(a+=S,"\n"===S){t+=1;break}}else if("/"===i&&"*"===e[t+1])for(a+="/*",t+=2;t<e.length;t++){var m=e[t];if(a+=m,"*"===m&&"/"===e[t+1]){a+="/",t+=2;break}}else a+=i,t+=1}var w="",k="";if(0!==r){w+="var ";for(var x=0;x<r;x++)w+=k+"m"+x,k=",";w+=";"}return w+a},generate:A,lex:y,parse:O}});