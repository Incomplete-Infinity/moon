/**
 * Moon Compiler vundefined
 * Copyright 2016-2019 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,a){"undefined"==typeof module?e.MoonCompile=a():module.exports=a()}(this,function(){"use strict";function j(e,a){return"\\"!==a&&('"'===e||"'"===e)}var P={element:0,text:1};var F=/^\s+$/,N=/&amp;|&gt;|&lt;|&nbsp;|&quot;|\\|"|\n|\r/g,U={class:"className",for:"htmlFor"},$={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n","\r":"\\r"};function k(e){e=e.trim();for(var a=[],r=0;r<e.length;){var t=e[r];if("<"===t){var i=e[r+1];if("/"===i){var n=e.indexOf(">",r+2),l=e.slice(r+2,n);0,a.push({type:"tagClose",value:l}),r=n+1;continue}if("!"===i&&"-"===e[r+2]&&"-"===e[r+3]){var v=e.indexOf("--\x3e",r+4);0,r=v+3;continue}var u="",f="",s=!1,o={},c=!0,b=0;for(r++;r<e.length;r++){var d=e[r];if("{"===d?b+=1:"}"===d&&(b-=1),0===b&&(">"===d||"/"===d&&">"===e[r+1]&&(s=!0)&&(r+=1))){r+=1;break}if(c)F.test(d)?c=!1:"="===d?(c=!1,f+=d):u+=d;else if(j(d,e[r-1]))for(f+=d,r++;r<e.length;r++){var h=e[r];if(f+=h,j(h,e[r-1])&&h===d)break}else f+=d}for(var p=0;p<f.length;p++){var g=f[p];if(!F.test(g)){for(var m="",S="true";p<f.length&&(g=f[p],!F.test(g));p++){if("="===g){S="";break}m+=g}if(m in U&&(m=U[m]),0===S.length){var k=f[++p];"{"===k?k="}":S+=k,p+=1;for(var x=0;p<f.length;p++)if("{"===(g=f[p]))x+=1,S+=g;else if("}"===k&&j(g,f[p-1]))for(S+=g,p++;p<f.length;p++){var w=f[p];if(S+=w,j(w,f[p-1])&&w===g)break}else if(g===k){if("}"!==k){S+=g,o[m]={value:S,isStatic:!0};break}if(0===x){o[m]={value:S,isStatic:!1};break}x-=1,S+=g}else S+=g}else o[m]={value:S,isStatic:!0}}}a.push({type:"tagOpen",value:u,attributes:o,closed:s})}else if("{"===t){var y="",O=0;for(r++;r<e.length;r++){var M=e[r];if("{"===M)O+=1,y+=M;else if("}"===M){if(0===O)break;O-=1,y+=M}else if(j(M,e[r-1]))for(y+=M,r++;r<e.length;r++){var C=e[r];if(y+=C,j(C,e[r-1])&&C===M)break}else y+=M}a.push({type:"tagOpen",value:"text",attributes:{"":{value:y,isStatic:!1}},closed:!0}),r+=1}else{for(var P="";r<e.length;r++){var q=e[r];if("<"===q||"{"===q)break;P+=q}F.test(P)||a.push({type:"tagOpen",value:"text",attributes:{"":{value:'"'+P.replace(N,function(e){return $[e]})+'"',isStatic:!0}},closed:!0})}}return a}function s(e,a,r,t){this.message=e,this.start=a,this.end=r,this.next=t}function x(e,a,r){var t=r[e],i=r[a-1],n=a-e;if(0==n)return new s("",e,a);if(1==n)return"tagOpen"===t.type&&!0===t.closed?{name:t.value,attributes:t.attributes,children:[]}:new s("",e,a);if("tagOpen"!==t.type||"tagClose"!==i.type||t.value!==i.value)return new s("",e,a);var l=function e(a,r,t){var i;if(0==r-a)return[];for(var n=a+1;n<=r;n++){var l=x(a,n,t);if(l instanceof s)i=l;else{var v=e(n,r,t);if(!(v instanceof s)){for(var u=[l],f=0;f<v.length;f++)u.push(v[f]);return u}}}return new s("",a,r,i)}(e+1,a-1,r);return l instanceof s?new s("",e,a,l):{name:t.value,attributes:t.attributes,children:l}}function q(e,a,r,t,i){var n=e+a;if(n in i)return{variable:r,variableStatic:i[n]};var l=i[n]="m"+r++;return t.push({variableStatic:l,variablePart:e+l+"="+a+";"}),{variable:r,variableStatic:l}}function z(e,a,r,t,i){var n,l=A(a.children[0],a,0,r,t,i);if(r=l.variable,l.isStatic){var v=q(l.prelude,l.node,r,t,i);r=v.variable,n=e+"="+v.variableStatic+";"}else n=""+l.prelude+e+"="+l.node+";";return{clause:n,variable:r}}function A(e,a,r,t,i,n){var l=e.name,v=!0,u=!0;if("element"===l)return function(e,a){var r=e.attributes,t=r.name,i=r.data,n=r.children;return{prelude:"",node:"Moon.view.m("+P.element+","+t.value+","+i.value+","+n.value+")",isStatic:t.isStatic&&i.isStatic&&n.isStatic,variable:a}}(e,t);if("if"===l)return function(e,a,r,t,i,n){var l="m"+t,v="",u=!0,f=z(l,e,t+1,i,n);if(v+="if("+e.attributes[""].value+"){"+f.clause+"}",t=f.variable,null!==a)for(var s=a.children,o=r+1;o<s.length;){var c=s[o];if("else-if"===c.name){var b=z(l,c,t,i,n);v+="else if("+c.attributes[""].value+"){"+b.clause+"}",t=b.variable,s.splice(o,1)}else{if("else"!==c.name)break;var d=z(l,c,t,i,n);v+="else{"+d.clause+"}",t=d.variable,u=!1,s.splice(o,1)}}if(u){var h=q("","Moon.view.m("+P.text+',"text",{"":""},[])',t,i,n);t=h.variable,v+="else{"+l+"="+h.variableStatic+";}"}return{prelude:v,node:l,isStatic:!1,variable:t}}(e,a,r,t,i,n);if("for"===l)return function(e,a,r,t){var i,n,l,v,u,f="m"+a,s="m"+(a+1),o="m"+(a+2),c=e.attributes,b=c[""].value,d=A(e.children[0],e,0,a+3,r,t);if(a=d.variable,d.isStatic){var h=q(d.prelude,d.node,a,r,t);a=h.variable,i="return "+h.variableStatic+";"}else i=d.prelude+"return "+d.node+";";if(i=s+"=function("+b+"){"+i+"};",v="in"in c?(l="for("+o+" in "+(n=c.in.value)+"){",o+","+n+"["+o+"]"):(l="for("+o+"=0;"+o+"<"+(n=c.of.value)+".length;"+o+"++){",n+"["+o+"],"+o),"data"in c)u=c.data.value;else{var p=q("","{}",a,r,t);a=p.variable,u=p.variableStatic}return{prelude:f+"=[];"+i+l+f+".push("+s+"("+v+"));}",node:"Moon.view.m("+P.element+","+("name"in c?c.name.value:'"span"')+","+u+","+f+")",isStatic:!1,variable:a}}(e,t,i,n);var f,s=e.attributes,o="",c="",b="",d="",h="";for(var p in s){var g=s[p];"children"===p?(g.isStatic||(u=!1),b=g.value):(g.isStatic||(v=!1),c+=d+'"'+p+'":'+g.value,d=",")}if(!("children"in s)){var m=e.children,S=[];b+="[";for(var k=0;k<m.length;k++){var x=A(m[k],e,k,t,i,n);x.isStatic||(u=!1),t=x.variable,S.push(x)}for(var w=0;w<S.length;w++){var y=S[w];if(u||!y.isStatic)o+=y.prelude,b+=h+y.node;else{var O=q(y.prelude,y.node,t,i,n);t=O.variable,b+=h+O.variableStatic}h=","}b+="]"}if(!v&&u){var M=q("",b,t,i,n);t=M.variable,b=M.variableStatic}if(l[0]===l[0].toUpperCase())return{prelude:o,node:l+"({"+c+d+"children:"+b+"})",isStatic:v&&u,variable:t};if(f="text"===l?P.text:P.element,c="{"+c+"}",v&&!u){var C=q("",c,t,i,n);t=C.variable,c=C.variableStatic}return{prelude:o,node:"Moon.view.m("+f+',"'+l+'",'+c+","+b+")",isStatic:v&&u,variable:t}}return function(e){for(var a,r="",t=0,i=0;i<e.length;){var n=e[i];if("("===n){r+=n,i+=1;for(var l="",v=0;i<e.length;){var u=e[i];if(")"===u&&0===v)break;if(j(u,e[i-1]))for(l+=u,i++;i<e.length;i++){var f=e[i];if(l+=f,j(f,e[i-1])&&f===u){i+=1;break}}else"("===u?v+=1:")"===u&&(v-=1),l+=u,i+=1}if("<"===(l=l.trim())[0]){var s=[],o={},c=A((a=k(l),void 0,x(0,a.length,a)),null,0,t,s,o);if(t=c.variable,c.isStatic){var b=q(c.prelude,c.node,t,s,o);t=b.variable,r+="(function(){if("+b.variableStatic+"===undefined){"+s[0].variablePart+"}return "+b.variableStatic+";})()"}else r+="(function(){"+(0===s.length?"":"if("+s[0].variableStatic+"===undefined){"+s.map(function(e){return e.variablePart}).join("")+"}")+c.prelude+"return "+c.node+";})()"}else r+=l}else if(j(n,e[i-1]))for(r+=n,i++;i<e.length;i++){var d=e[i];if(r+=d,j(d,e[i-1])&&d===n){i+=1;break}}else if("/"===n&&"/"===e[i+1])for(;i<e.length;i++){var h=e[i];if(r+=h,"\n"===h){i+=1;break}}else if("/"===n&&"*"===e[i+1])for(r+="/*",i+=2;i<e.length;i++){var p=e[i];if(r+=p,"*"===p&&"/"===e[i+1]){r+="/",i+=2;break}}else r+=n,i+=1}var g="",m="";if(0!==t){g+="var ";for(var S=0;S<t;S++)g+=m+"m"+S,m=",";g+=";"}return g+r}});